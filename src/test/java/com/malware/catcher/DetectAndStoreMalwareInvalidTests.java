package com.malware.catcher;

import com.malware.catcher.model.DetectionData;
import com.malware.catcher.model.DeviceData;
import com.malware.catcher.service.DetectorService;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.mockito.InjectMocks;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;

import java.sql.Timestamp;
import java.time.Instant;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.UUID;

@DataJpaTest
class DetectAndStoreMalwareInvalidTests {

    @InjectMocks
    DetectorService mockDetectorService;

    @Test
    public void storeInvalidData() throws Exception {

        // WINDOWS data - NEW DETECTION
        DeviceData deviceDataAndroid = new DeviceData(1L, UUID.randomUUID(), "WINDOWS", "Samsung", "v12", null);
        List<DetectionData> detectionDataAndroidList = new ArrayList<DetectionData>(Arrays.asList(
                new DetectionData(100L, UUID.randomUUID(), Timestamp.from(Instant.now()), "Facebook", "Social Media", null, deviceDataAndroid),
                new DetectionData(101L, UUID.randomUUID(), Timestamp.from(Instant.now()), "Instagram", "Social Media", null, deviceDataAndroid)
        ));
        try {
            mockDetectorService.validateDetectorRequestData(deviceDataAndroid, detectionDataAndroidList);
        } catch (Exception e) {
            // java.lang.Exception: DeviceType can only be WEB, ANDROID, or IOS.
            Assertions.assertThat(true);
        }
    }

}
